# Use the latest 2.1 version of CircleCI pipeline process engine.
# See: https://circleci.com/docs/2.0/configuration-reference
version: 2.1

# Define a job to be invoked later in a workflow.
# See: https://circleci.com/docs/2.0/configuration-reference/#jobs
orbs:
  docker: circleci/docker@1.5.0
  executors:
    docker-publisher:
      environment:
        IMAGE_NAME: kevin976/django-docker
        docker:
          image: circleci/django:latest
          auth:
            username: $DOCKERHUB_USERNAME
            password: $DOCKERHUB_PASSWORD
          jobs:
            publishLatestToHub:
              executor: docker-publisher
          steps:
            checkout
            setup_remote_docker
          run:
            name: Publish Docker Image to Docker Hub
            command: |
              echo "$DOCKERHUB_PASSWORD" | docker login -u "$DOCKERHUB_USERNAME" - password-stdin
              docker build -t $IMAGE_NAME .
              docker push $IMAGE_NAME:latest
workflows:
  version: 2
  build-master:
    jobs:
      publishLatestToHub