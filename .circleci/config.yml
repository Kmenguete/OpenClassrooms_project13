# Use the latest 2.1 version of CircleCI pipeline process engine.
# See: https://circleci.com/docs/2.0/configuration-reference
version: 2.1
orbs:
  python: circleci/python@2.1.1

  jobs:
    test_and_linting:
      docker:
        - image: kevin976/circleci:latest
          auth:
            # ensure you have first added these secrets
            # visit app.circleci.com/settings/project/github/Kmenguete/OpenClassrooms_project13/environment-variables
            username: $DOCKERHUB_USERNAME
            password: $DOCKERHUB_PASSWORD
      steps:
        - checkout
        - run: |
            docker build -t $IMAGE_NAME .
            flake8
            pytest
    publishLatestToHub:
      docker:
        - image: kevin976/circleci:latest
          auth:
            # ensure you have first added these secrets
            # visit app.circleci.com/settings/project/github/Kmenguete/OpenClassrooms_project13/environment-variables
            username: $DOCKERHUB_USERNAME
            password: $DOCKERHUB_PASSWORD
      steps:
        - checkout
        - run: | 
            docker build -t $IMAGE_NAME .
            docker push $IMAGE_NAME:latest

workflows:
  version 2:
  my_custom_workflow:
    jobs:
      - test_and_linting
      - publishLatestToHub
